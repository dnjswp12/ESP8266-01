
/*
 Header file for USART #0 
*/ 


#define sbi(reg, bit)    reg |= (1<<(bit))    
#define cbi(reg, bit)    reg &= ~(1<<(bit))

void USART0_Init( INT16 ubrr );
void USART0_Transmit( char data );
void USART0_Transmit_String(char *str);
void USART0_Transmit_NewLine(void);
char USART0_Receive( void );


void USART0_Init( INT16 ubrr )
{
	// Set baud rate
	UBRR0H = (INT8)(ubrr>>8);
	UBRR0L = (INT8)ubrr;
	// Enable U2X
	if(U2X_S == 2)
		sbi(UCSR0A, U2X);
	else
		cbi(UCSR0A, U2X);
	// Enable receiver and transmitter
	sbi(UCSR0B, RXEN);
	sbi(UCSR0B, TXEN);

	// Set frame format: 8data, 1stop bit
	cbi(UCSR0C, UMSEL);  // asynch
	cbi(UCSR0C, USBS);   // 1 Stop bit
	cbi(UCSR0C, UPM01);  // No parity
	cbi(UCSR0C, UPM00);
	cbi(UCSR0B, UCSZ02); // 8-bit
	sbi(UCSR0C, UCSZ01);
	sbi(UCSR0C, UCSZ00);

	// Enable interrupt
//	sbi(UCSR0B, RXCIE);  // RX
//	sbi(UCSR0B, TXCIE);  // TX
//	sbi(UCSR0B, UDRIE);  // UDR Empty

//	sei();  // Enable all interrupt
}

void USART0_Transmit( char data )
{
	// Wait for empty transmit buffer
	while ( !( UCSR0A & 0x20 ) )   // (1<<UDRE)
	;
	// Put data into buffer, sends the data
	UDR0 = data;
}

void USART0_Transmit_String(char *str)
{
	while(*str != '\0')
	{
		if(*str == '\n')
		{
			USART0_Transmit_NewLine();
		}
		else
		{
			USART0_Transmit(*str);
		}
		str++;
	}
}

void USART0_Transmit_NewLine(void)
{
	USART0_Transmit(0x0A); // LF
	USART0_Transmit(0x0D); // CR
}


char USART0_Receive( void )
{
	// Wait for data to be received
	while ( !(UCSR0A & 0x80) )  //(1<<RXC)
	{
		;
	}
	// Get and return received data from buffer
	return UDR0;
}


////////////////////////////////////////////////////////////SRC////////////////////////////////////////////////////////////


#define F_CPU 8000000UL
#define BAUD  9600 
#define U2X_S  2     // U2X --> 1 or 2 
#define MYUBRR ((F_CPU*U2X_S)/(16L*BAUD)-1) 

#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>
#include "Usartheader.h"


int main(void)
{
   INT8 rx_buf;
   DDRG = 0xff;
   USART0_init(MYUBRR);
   _delay_ms(100);
   PORTG = 0xff;

    while(1)
    {
      rx_buf = USART0_Receive();
      if (rx_buf == 9)
      {
         PORTG = 0x00;
         _delay_ms(100);
      }
      if (rx_buf == 0)
      {
         PORTG = 0xff;
         _delay_ms(100);
      }
        //TODO:: Please write your application code 
    }
}


////////////////////////////////////////////////////////////SRC2////////////////////////////////////////////////////////////


ypedef unsigned char INT8;
typedef unsigned int INT16;
#define F_CPU 8000000
#define BAUD 9600
#define U2X_S 2 // U2X Ã  1 or 2
#define MYUBRR ((F_CPU*U2X_S)/(16L*BAUD)-1)
#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>
#include "USART_ch0.h"

INT8 data = 0;

ISR(USART0_RX_vect)
{
   data = UDR0;
   
}

int main(void)
{
   DDRD = 0xff;
   USART0_Init ( MYUBRR );
   // Enable interrupt
   sbi(UCSR0B, RXCIE); // RX
   sei( );
   _delay_ms(100);
   
   while(1)
   {
      
      if (data == '1' || data == 1)
      {
         PORTD = 0b01111111;
         data = 0xff;
      }
      
      else if (data == '3')
      {
         PORTD = 0b10111111;
         data = 0xff;
      }
      
      else if (data == '0' || data == 0)
      {
         PORTD = 0b11011111;
         data = 0xff;
      }
      
      else if (data == '2')
      {
         PORTD = 0b11001111;
         data = 0xff;
      }
      
      else if (data == '4')
      {
         PORTD = 0b11000111;
         data = 0xff;
      }
      
      else if (data == '6')
      {
         PORTD = 0b11000011;
         data = 0xff;
      }
      
      else if (data == 'F')
      {
         PORTD = 0b11111101;
         data = 0xff;
      }
      
      else if (data == 'S')
      {
         PORTD = 0b11111110;
         data = 0xff;
      }
      
      else if (data == 'R')
      {
         PORTD = 0b00000000;
         data = 0xff;
      }
      
      
      
      else
      {
         ;
      }
      
      
   }
}
